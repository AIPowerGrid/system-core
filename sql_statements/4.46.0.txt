-- Add progress tracking columns to processing_gens table
ALTER TABLE processing_gens
ADD COLUMN IF NOT EXISTS progress_percent INTEGER NOT NULL DEFAULT 0,
ADD COLUMN IF NOT EXISTS current_step INTEGER NOT NULL DEFAULT 0,
ADD COLUMN IF NOT EXISTS total_steps INTEGER NOT NULL DEFAULT 0,
ADD COLUMN IF NOT EXISTS progress_updated_at TIMESTAMP,
ADD COLUMN IF NOT EXISTS wallet_id VARCHAR(42);

-- Add index on wallet_id for efficient lookups
CREATE INDEX IF NOT EXISTS ix_processing_gens_wallet_id ON processing_gens(wallet_id);

-- Add wallet_id to waiting_prompts table for tracking requester's wallet
ALTER TABLE waiting_prompts
ADD COLUMN IF NOT EXISTS wallet_id VARCHAR(42);

CREATE INDEX IF NOT EXISTS ix_waiting_prompts_wallet_id ON waiting_prompts(wallet_id);

